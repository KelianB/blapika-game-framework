<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: audio-manager.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: audio-manager.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
    global $ Engine
*/

// /!\ Do not use audio.play() or audio.volume. Instead use respectively AudioManager.play and AudioManager.setVolume

/** @class
 * @classdesc An utility class which improves audio for JS apps. Extends audio capabilities and handles features such as global volume, mute, ...
 */
Engine.prototype.AudioManager = new function() {
    var self = this;
    this.volumeModifier = 1;
    this.playing = [];
    this.muted = false;

    // -------- Audio prototype changes --------

    /** Fades the volume of the audio element to a given value in a given duration.
     * @param {Number} targetVolume - The volume at which the audio will end.
     * @param {Number} duration - The time it should take to reach the target volume, in milliseconds.
     */
    Audio.prototype.fadeTo = function(targetVolume, duration) {
        $(this).animate({volume: targetVolume}, duration);
    };

    /** Sets the volume of an Audio element.
     * @param {Number} volume - The new volume, between 0 and 1.
     */
    Audio.prototype.setVolume = function(volume) {
        this.absoluteVolume = volume;
        self.applyVolumeTransforms(this);
    };

    // -------- Audio Manager functions --------

    /** Sets the playing volume of a given Audio element, handling the global volume modifier.
     * @param {Audio} audio - The target Audio element.
     */
    this.applyVolumeTransforms = function(audio) {
        audio.absoluteVolume = audio.absoluteVolume || 1;
        audio.volume = audio.absoluteVolume * this.volumeModifier;
    };

    /** Sets the volume modifier which will multiply the volume of all sounds.
     * @param {Number} volumeModifier - The volume multiplier, between 0 and 1.
     */
    this.setVolumeModifier = function(volumeModifier) {
        this.volumeModifier = volumeModifier;
        for(var i = 0; i &lt; this.playing.length; i++)
            this.applyVolumeTransforms(this.playing[i]);
    };

    /** Plays audio after cloning the audio element, allowing it to be played multiple times simultaneously.
     * @param {Audio} audio - The audio element to play.
     * @param {Object} [fadeIn] - An object describing how to fade the audio (properties: start, end, duration).
     */
    this.playRepeatable = function(audio, fadeIn) {
        this.play(audio.cloneNode(), false, fadeIn);
    };

    /** Plays audio.
     * @param {Audio} audio - The audio element to play.
     * @param {Boolean} [reset=false] - Whether or not to reset the currentTime of the Audio before playing it.
     * @param {Object} [fadeIn] - An object describing how to fade the audio (properties: start, end, duration).
     */
    this.play = function(audio, reset, fadeIn) {
        if(reset)
            audio.currentTime = 0;

        if(fadeIn) {
            audio.volume = fadeIn.start;
            audio.fadeTo(fadeIn.end, fadeIn.duration);
        }

        audio.addEventListener("ended", function() {
            // Remove from playing array
            self.playing.splice(self.playing.indexOf(this), 1);
        });

        this.playing.push(audio);

        audio.muted = this.muted;
        audio.play();
    };

    /** Plays audio repeatedly.
     * @param {Audio} audio - The audio element to play.
     * @param {Integer} [count=infinite] - How many times the audio should be played.
     */
    this.loop = function(audio, count) {
        if(count == undefined)
            count = -1;

        if(count != 0) {
            self.play(audio, true);

            audio.addEventListener("ended", function() {
                console.log(this, --count);
                self.loop(this, --count);
            });
        }
    };

    /** Toggles mute for all audio elements. */
    this.toggleMute = function() {
        this.muted = !this.muted;

        for(var i = 0; i &lt; this.playing.length; i++)
            this.playing[i].muted = this.muted;
    };

    /** Stops all audio currently playing.
     * @param {Number} [fadeOutDuration] - The duration of the fade-out effect.
     */
    this.stopAll = function(fadeOutDuration) {
        for(var i = 0; i &lt; this.playing.length; i++) {
            var audio = this.playing[i];
            if(fadeOutDuration == undefined) {
                audio.pause();
                audio.currentTime = 0;
            }
            else {
                audio.fadeTo(0, fadeOutDuration);
                setTimeout(function(){
                    audio.pause();
                }, fadeOutDuration);
            }
        }
    };
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Engine.html">Engine</a></li><li><a href="Engine_Animation.html">Animation</a></li><li><a href="Engine_AudioManager.html">AudioManager</a></li><li><a href="Engine_Core.html">Core</a></li><li><a href="Engine_Debug.html">Debug</a></li><li><a href="Engine_EventListener.html">EventListener</a></li><li><a href="Engine_ParticleSpawner.html">ParticleSpawner</a></li><li><a href="Engine_ResourceManager.html">ResourceManager</a></li><li><a href="Engine_State.html">State</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Tue Aug 23 2016 22:54:53 GMT+0200 (Paris, Madrid (heure d’été))
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
